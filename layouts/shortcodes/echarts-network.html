{{/*
    Docs: https://docs.hugoblox.com/reference/markdown/#inline-image

    Parameters
    ----------
    name :
        Icon name / ID.
*/}}

{{- $name := .Get "name" | default "Network Graph" -}}
{{- $id := .Get "id" | default (replaceRE "[^a-zA-Z0-9]" "_" $name) -}}

{{- $yamlfile := .Get "data" -}}
{{- $matches := .Page.Resources.Match $yamlfile -}}
{{- $res := first 1 $matches | index 0 -}}

{{- if not $res }}
  <p><strong>Error:</strong> Could not find resource "{{ $yamlfile }}".</p>
{{ else }}
  {{- $graph := $res | transform.Unmarshal }}

  <div id="{{ $id }}" style="width: 100%; height: 600px;"></div>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <script>
    const chart = echarts.init(document.getElementById('{{ $id }}'));
    chart.setOption({
      title: {
        text: '{{ $name }}',
        left: 'center'
      },
      tooltip: {},
      series: [{
        type: 'graph',
        layout: 'force',
        roam: true,
        label: { show: true, position: 'right' },
        force: { repulsion: 260, edgeLength: [50, 150] },
        data: {{ $graph.nodes | jsonify }},
        links: {{ $graph.links | jsonify }}
      }]
    });
  </script>
{{- end }}